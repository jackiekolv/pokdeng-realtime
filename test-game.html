<!DOCTYPE html>
<html>
<head>
    <title>Pokdeng Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .card { width: 100px; height: 140px; border: 1px solid #ccc; margin: 5px; display: inline-block; }
        .card img { width: 100%; height: 100%; object-fit: contain; }
        .controls { margin: 20px 0; }
        .controls button { margin: 5px; padding: 10px 20px; font-size: 16px; }
        .chat { border: 1px solid #ccc; height: 200px; overflow-y: scroll; padding: 10px; margin: 10px 0; }
        .info { background: #f0f0f0; padding: 10px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>Pokdeng Game Test</h1>
    
    <div class="info">
        <div>Player: <span id="player-name">Loading...</span></div>
        <div>Session: <span id="session-id">Loading...</span></div>
        <div>Status: <span id="status">Connecting...</span></div>
    </div>
    
    <div class="controls">
        <button id="pok-btn">POK (Deal 2 cards)</button>
        <button id="hit-btn">HIT (Draw 1 card)</button>
        <button id="shuffle-btn">SHUFFLE</button>
    </div>
    
    <div id="cards">
        <div class="card" id="card1">
            <img src="PNG-cards-1.3/red_joker.png" alt="Card 1">
        </div>
        <div class="card" id="card2">
            <img src="PNG-cards-1.3/red_joker.png" alt="Card 2">
        </div>
        <div class="card" id="card3" style="display: none;">
            <img src="PNG-cards-1.3/red_joker.png" alt="Card 3">
        </div>
    </div>
    
    <div class="chat" id="chat"></div>
    
    <script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>
    <script>
        const socket = io();
        const playerName = 'TestPlayer_' + Math.floor(Math.random() * 1000);
        let sessionJoined = false;
        
        // Elements
        const playerNameEl = document.getElementById('player-name');
        const sessionIdEl = document.getElementById('session-id');
        const statusEl = document.getElementById('status');
        const chatEl = document.getElementById('chat');
        const card1 = document.getElementById('card1').querySelector('img');
        const card2 = document.getElementById('card2').querySelector('img');
        const card3 = document.getElementById('card3');
        const card3Img = card3.querySelector('img');
        
        playerNameEl.textContent = playerName;
        
        // Socket events
        socket.on('connect', () => {
            statusEl.textContent = 'Connected';
            addChatMessage('System', 'Connected to server');
            socket.emit('join_game', { playerName });
        });
        
        socket.on('session_joined', (data) => {
            sessionJoined = true;
            sessionIdEl.textContent = data.sessionId;
            statusEl.textContent = 'In Game';
            addChatMessage('System', 'Joined game session: ' + data.sessionId);
        });
        
        socket.on('chat', (data) => {
            addChatMessage(data.username, data.message);
        });
        
        socket.on('cards', (data) => {
            if (data.cards && data.cards.length >= 2) {
                card1.src = 'PNG-cards-1.3/' + data.cards[0];
                card2.src = 'PNG-cards-1.3/' + data.cards[1];
                card3.style.display = 'none';
                
                let message = `Cards dealt! Hand value: ${data.handValue}`;
                if (data.specialHand && data.specialHand.type !== 'normal') {
                    message += ` (${data.specialHand.type} x${data.specialHand.multiplier})`;
                }
                addChatMessage('Game', message);
            }
        });
        
        socket.on('card3', (data) => {
            if (data.card) {
                card3Img.src = 'PNG-cards-1.3/' + data.card;
                card3.style.display = 'inline-block';
                addChatMessage('Game', `Third card dealt! Total hand value: ${data.handValue}`);
            }
        });
        
        socket.on('shuffle', (data) => {
            card1.src = 'PNG-cards-1.3/red_joker.png';
            card2.src = 'PNG-cards-1.3/red_joker.png';
            card3.style.display = 'none';
            addChatMessage('Game', `Deck shuffled! Cards remaining: ${data.remainingCards}`);
        });
        
        socket.on('error', (data) => {
            addChatMessage('Error', data.message);
            alert('Error: ' + data.message);
        });
        
        // Button events
        document.getElementById('pok-btn').addEventListener('click', () => {
            if (!sessionJoined) {
                alert('Please wait for game session to join');
                return;
            }
            socket.emit('command', { username: playerName, message: 'pok' });
        });
        
        document.getElementById('hit-btn').addEventListener('click', () => {
            if (!sessionJoined) {
                alert('Please wait for game session to join');
                return;
            }
            socket.emit('command', { username: playerName, message: 'hit' });
        });
        
        document.getElementById('shuffle-btn').addEventListener('click', () => {
            if (!sessionJoined) {
                alert('Please wait for game session to join');
                return;
            }
            socket.emit('command', { username: playerName, message: 'shuffle' });
        });
        
        function addChatMessage(username, message) {
            const time = new Date().toLocaleTimeString();
            const div = document.createElement('div');
            div.innerHTML = `<strong>${username}:</strong> ${message} <small>@${time}</small>`;
            chatEl.appendChild(div);
            chatEl.scrollTop = chatEl.scrollHeight;
        }
    </script>
</body>
</html>
